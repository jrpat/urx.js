<!doctype html>
<html>
  <head>
    <link rel=stylesheet href="/base.css">
    <script src="/jr.js"></script>
    <script src="/util.js"></script>
  </head>
  <body vbox=stretch>
    <pre id=logOutput></pre>

    <script src="/urx-part1_test.js" type=module></script>


    <script id=plain type=none>
      import {Atom, Calc, Effect} from '/urx-part1.js'

      let a1 = Atom('a').label('a1')
      let c1 = Calc(() => a1.value + '!').label('c1')
      let e1 = Effect(() => { log(c1.value) }).label('log')
      Object.assign(window, {a1, c1, e1})

      a1.value = 'aaa'
    </script>

    <script id=cycle-static-direct type=none>
      import {Atom, Calc, Effect} from '/urx-part1.js'

      let a1 = Atom('old').label('a1')
      let c1 = Calc(() => (a1.value == 'old') ? c1.value : 'ok').label('c1')
      let e1 = Effect(() => log(c1.value)).label('log')
      Object.assign(window, {a1, c1, e1})

      a1.value = 'new'
    </script>

    <script id=cycle-static-indirect type=none>
      import {Atom, Calc, Effect} from '/urx-part1.js'

      let a1 = Atom('old').label('a1')
      let c1 = Calc(() => (a1.value == 'old') ? c2.value : 'ok').label('c1')
      let c2 = Calc(() => c3.value).label('c2')
      let c3 = Calc(() => c1.value).label('c3')
      let e1 = Effect(() => log(c1.value)).label('log')
      Object.assign(window, {a1, c1, c2, c3, e1})

      a1.value = 'new'
    </script>

    <script id=cycle-dynamic type=none>
      import {Atom, Calc, Effect} from '/urx-part2.js'

      let a1 = Atom('old').label('a1')

      let c1 = Calc(() => `${a1()}!`).label('c1')

      let c21 = Calc(() => {
        return (a1() == 'new')
          ? `${c1()}-${c22()}`
          : `${c1()}`
      }).label('c21')

      var c22 = Calc(() => `${a1()}-${c21()}`).label('c22')


      Effect(() => log('c21', c21())).label('elog_c21')
      Effect(() => log('c22', c22())).label('elog_c22')

      Object.assign(window, {a1, c1, c21, c22})

      a1.set('new')
      a1.set('foo')
    </script>
  </body>
</html>


